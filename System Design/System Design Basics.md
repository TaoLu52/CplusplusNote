## 引言：
设计大型系统需要考虑如下几个方面：
1. 建构系统时有哪些不同的构件可以使用
2. 这些组件怎样与别的组件组合成一个系统并协同工作
3. 对于不同组件如何取舍，各组件的权重如何分配
## 一、分布式系统的的关键特性
分布式系统的关键特性包括：
	1. 可扩展
	2. 可靠
	3. 有效
	4. 高效
	5. 可维护
### 可扩展
系统应该能随着需求、维护费用等的变化在不损失性能的前提下进行扩充或缩减。
#### 水平扩展与垂直扩展（Vertical Scaling vs. Horizontal Scaling）
**水平扩展**：通过往资源池添加更多服务器来实现扩展；**垂直扩展**：通过提升现有服务器的能力（使用更强的CPU，更大的存储器等）来实现扩展。
通常水平扩展比垂直扩展更容易。在水平扩展方面的范例是Cassandra 和MongoDB。而在垂直扩展方面的范例是MySQL。
垂直扩展的一个缺点是垂直扩展通常会导致系统下线维护。
![[Pasted image 20231025144218.png]]
### 可靠与有效
**可靠性**指系统能够稳定运行服务，即使在部分服务器故障时服务依然可以运行。**有效性**指系统在特定时间段内系统可以提供服务的时间。
可靠性需要通过软硬件的**冗余备份**来实现。显然冗余备份是有成本的，但是需要通过这种方式来消除各个**单点失败**。有效性关注的是系统维护、修复、空档等时间。
如果一个系统具有较高的可靠性，那这个系统就具有较高的可用性。而一个系统如果不可靠，它同样可以通过尽可能缩短维护时间等手段提高有效性。
### 高效
精准的测量系统的效率的是比较困难的，但是可以使用吞吐量等类似的指标来粗略的衡量
### 可用、可维护
我们设计的系统应该是易于操作与维护的。
快速诊断并精准定位错误，在早期发现问题都是提高这两个指标的关键。
## 二、负载均衡（Load Balancing）
### 负载均衡介绍
负载均衡是分布式系统一个很重要的组件。它可以提高系统的吞吐量并提升系统的稳定性。同时，负载均衡也担负着跟踪系统各项资源状态的任务。如果一台服务器在某一时刻无法提供服务或故障率显著提高，负载均衡可以不再将请求分给这台服务器。
负载均衡通常位于客户端和服务器之间，使用算法将各个客户端的请求分发给不同的服务器。具体拓扑如下图所示：
![[Pasted image 20231025152611.png]]
负载均衡可以避免单点失败并提高系统的可用性及相应效率。
为了实现可扩展性和冗余备份并平衡系统每一层的负载，我们可以在这三个地方加入负载均衡：
- user 与 web server间
- web server和内部platform层之间（比如application server和cache server）之间
- 在platform层和数据库之间
如下图：
![[Pasted image 20231025153645.png]]
### 负载均衡的益处
- 用户体验更快的没有中断的服务。
- 提高系统下线维护时间，提升系统吞吐量。
- 系统管理员可以更方便的分配到来的请求。
- 智能化的负载均衡可以在流量阻塞瓶颈真正发生前进行预测、分析、判断。这样可以让团队对系统有更深层次的认识，为团队商务上的判断提供支持。
### 负载均衡算法
健康检测（Health Checks ）是负载均衡算法的重要依据，负载均衡应该只向健康的服务器转发请求。
算法有：
1. 最少链接
2. 最少相应时间
3. 最少带宽占用
4. 轮询法 Round Robin Method
5. 带权轮询法 Weighted Round Robin Method
6. IP Hash
### 负载均衡备份
负载均衡容易成为系统的单点故障点，为了克服这一缺点，可以使用备用的LB Server与主LB Server相连，互相检测对方的健康状态，一旦主服务器失效，副服务器就可以启用并接管负载均衡的工作
![[Pasted image 20231025155605.png]]
## 三、缓存（ Caching ）
### 应用服务器缓存（Application server cache）
### CDN ( Content Distribution Network )
### Cache Invalidation
### Cache eviction policies
